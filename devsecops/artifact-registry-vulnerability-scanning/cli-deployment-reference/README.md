# To manually trigger deployent in a non-safe-inputs GCP project

## Set up env variables

Authorize project login, modify variables below:

```
export BRANCH_NAME=main
export PROJECT_ID=$PROJECT_ID
export PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format="value(projectNumber)")
export BUCKET_NAME=$PROJECT_ID-bucket-of-risk
export VULN_CLOUD_FUNCTION_SERVICE_ACCOUNT=$PROJECT_ID/$PROJECT_ID-vuln-gcf
export REPO_NAME=$PROJECT_ID-repo-of-risk
export REGION=northamerica-northeast1
```

## Run script to provision resources and deploy cloud function

```
./init.sh
```

#### To get list of severities of an image (not used in function):

```
gcloud artifacts docker images list --show-occurrences \
northamerica-northeast1-docker.pkg.dev/$PROJECT_ID/$PROJECT_ID-repo-of-risk/nginx
```

#### To get all vunerabilities for an image and save to local file:

```
gcloud artifacts docker images list --show-occurrences \
--occurrence-filter='kind="VULNERABILITY"' --format=json \
northamerica-northeast1-docker.pkg.dev/$PROJECT_ID/$PROJECT_ID-repo-of-risk/nginx > vunerabilities.json
```
